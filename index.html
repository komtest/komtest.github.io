<!DOCTYPE html>
<html lang="es" id="htmlRoot">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bit√°cora Komtest Pro</title>
  
  <!-- PWA Essential -->
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png">
  <meta name="theme-color" content="#0d6efd">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="preload" as="image" href="/logo-komtest.png">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">
  <!-- Modal de inicio -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Bienvenido, T√©cnico</h5>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Nombre completo</label>
            <input type="text" class="form-control" id="nombreTecnicoInput" placeholder="Ej: Juan P√©rez" required>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="darkModeToggle">
            <label class="form-check-label" for="darkModeToggle">Modo oscuro</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="btnIniciar">Iniciar Sesi√≥n</button>
        </div>
      </div>
    </div>
  </div>

  <div class="container py-4" id="appContainer" style="display:none;">
    <header class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h4 fw-bold text-primary">Bit√°cora de Actividades - Komtest</h1>
        <p class="mb-0">T√©cnico: <strong id="nombreMostrado"></strong></p>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-secondary btn-sm" id="btnRespaldo">üì• Respaldo JSON</button>
      </div>
    </header>

    <section class="card mb-4 shadow-sm">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Registrar Actividad</h5>
      </div>
      <div class="card-body">
        <form id="activityForm">
          <input type="hidden" id="editId">
          <div class="row">
            <div class="col-md-4 mb-3">
              <label for="fecha" class="form-label">Fecha</label>
              <input type="date" class="form-control" id="fecha" required>
            </div>
            <div class="col-md-4 mb-3">
              <label for="horaInicio" class="form-label">Hora Inicio</label>
              <input type="time" class="form-control" id="horaInicio" required>
            </div>
            <div class="col-md-4 mb-3">
              <label for="horaFin" class="form-label">Hora Fin</label>
              <input type="time" class="form-control" id="horaFin" required>
            </div>
          </div>
          <div class="mb-3">
            <label for="tipo" class="form-label">Tipo de Actividad</label>
            <select class="form-select" id="tipo" required>
              <option value="">Seleccione...</option>
              <option value="Soporte virtual">Soporte virtual para asistencia de fallas</option>
              <option value="Soporte presencial">Soporte presencial para asistencia de fallas</option>
              <option value="Reparaci√≥n electr√≥nica">Reparaciones electr√≥nicas de dispositivos</option>
              <option value="Asistencia t√©cnica">Asistencia de informaci√≥n t√©cnica</option>
              <option value="Bombas e inyectores">Asistencia en bombas e inyectores (diesel/gasolina)</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="descripcion" class="form-label">Descripci√≥n detallada</label>
            <textarea class="form-control" id="descripcion" rows="3" placeholder="Ej: Diagn√≥stico remoto de falla en banco K-300..." required></textarea>
          </div>
          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success" id="btnGuardar">Agregar Actividad</button>
            <button type="button" class="btn btn-outline-secondary d-none" id="btnCancelarEdicion">Cancelar</button>
          </div>
        </form>
      </div>
    </section>

    <section class="card mb-4 shadow-sm">
      <div class="card-header bg-secondary text-white">
        <h5 class="mb-0">Generar Informe</h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-5">
            <label class="form-label">Rango de Fechas</label>
            <input type="date" class="form-control" id="fechaInicio">
            <input type="date" class="form-control mt-2" id="fechaFin">
          </div>
          <div class="col-md-7 d-flex align-items-end gap-2">
            <button id="btnGenerarPDF" class="btn btn-primary">üìÑ Generar PDF</button>
            <button id="btnGenerarExcel" class="btn btn-success">üìä Exportar Excel</button>
            <button id="btnVerReporte" class="btn btn-outline-secondary">üëÅÔ∏è Ver Reporte</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Filtros avanzados -->
    <section class="card mb-4 shadow-sm d-none" id="filtrosSection">
      <div class="card-header bg-light">
        <h6 class="mb-0">Filtros Avanzados</h6>
      </div>
      <div class="card-body">
        <div class="row g-2">
          <div class="col-md-4">
            <select class="form-select" id="filtroTipo">
              <option value="">Todos los tipos</option>
              <option value="Soporte virtual">Soporte virtual</option>
              <option value="Soporte presencial">Soporte presencial</option>
              <option value="Reparaci√≥n electr√≥nica">Reparaci√≥n electr√≥nica</option>
              <option value="Asistencia t√©cnica">Asistencia t√©cnica</option>
              <option value="Bombas e inyectores">Bombas e inyectores</option>
            </select>
          </div>
          <div class="col-md-5">
            <input type="text" class="form-control" id="filtroDescripcion" placeholder="Buscar en descripci√≥n...">
          </div>
          <div class="col-md-3">
            <button class="btn btn-outline-secondary w-100" id="btnLimpiarFiltros">Limpiar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Estad√≠sticas -->
    <section class="card mb-4 shadow-sm d-none" id="estadisticasSection">
      <div class="card-header bg-dark text-white">
        <h5 class="mb-0">Estad√≠sticas del T√©cnico</h5>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-md-3 mb-3">
            <div class="stat-card">
              <h3 id="totalActividades">0</h3>
              <p class="text-muted">Actividades</p>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="stat-card">
              <h3 id="totalHoras">0h 0m</h3>
              <p class="text-muted">Horas trabajadas</p>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="stat-card">
              <h3 id="promedioDiario">0h</h3>
              <p class="text-muted">Promedio diario</p>
            </div>
          </div>
          <div class="col-md-3 mb-3">
            <div class="stat-card">
              <h3 id="tipoPrincipal">-</h3>
              <p class="text-muted">Tipo principal</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tabla de actividades -->
    <section id="reporteContainer" class="d-none">
      <div id="reportePDF" class="card shadow-sm">
        <div class="card-header bg-dark text-white text-center">
          <h4>Informe de Actividades - Banco de Pruebas Komtest</h4>
          <p id="rangoFechas" class="mb-0">Del <span id="fechaInicioReporte"></span> al <span id="fechaFinReporte"></span></p>
        </div>
        <div class="card-body">
          <table class="table table-bordered">
            <thead class="table-light">
              <tr>
                <th>Fecha y Horario</th>
                <th>Tipo</th>
                <th>Descripci√≥n</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="tablaActividades"></tbody>
          </table>
          <div class="mt-4 text-end">
            <p>Fecha: <span id="fechaFirma"></span></p>
            <p>Firma: _________________________</p>
            <p>Nombre: <strong id="nombreEnReporte"></strong></p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer class="text-center text-muted py-3 mt-4 border-top">
    <small>¬© 2025 Komtest - Sistemas de Prueba Diesel y Gasolina | v2.1</small>
  </footer>

  <!-- Librer√≠as -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
